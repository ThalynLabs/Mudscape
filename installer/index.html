<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mudscape Installer</title>
  <style>
    :root {
      --bg: #1a1a2e;
      --surface: #16213e;
      --primary: #0f3460;
      --accent: #e94560;
      --text: #eee;
      --text-secondary: #aaa;
      --success: #4ade80;
      --border: #2a2a4a;
      --warning: #fbbf24;
    }
    
    * { box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 750px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    h1 {
      color: var(--accent);
      margin-bottom: 10px;
      font-size: 2.5rem;
    }
    
    .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .step {
      display: none;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
    }
    
    .step.active { display: block; }
    
    .step-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .step-number {
      background: var(--accent);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    
    .step-title {
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    .step-content {
      margin-bottom: 25px;
    }
    
    .step-content p { margin: 0 0 15px 0; }
    
    .code-block {
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 0.95rem;
      overflow-x: auto;
      position: relative;
      margin: 15px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .code-block code { color: #7ee787; }
    
    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--primary);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    
    .copy-btn:hover { background: var(--accent); }
    .copy-btn.copied { background: var(--success); }
    
    .buttons {
      display: flex;
      gap: 15px;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    button {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--accent);
      color: white;
    }
    
    .btn-primary:hover { filter: brightness(1.1); }
    
    .btn-secondary {
      background: var(--primary);
      color: white;
    }
    
    .btn-secondary:hover { filter: brightness(1.2); }
    
    .btn-success {
      background: var(--success);
      color: #000;
      font-weight: 600;
    }
    
    .btn-success:hover { filter: brightness(1.1); }
    
    .btn-large {
      padding: 20px 40px;
      font-size: 1.2rem;
    }
    
    .btn-primary:disabled, .btn-success:disabled {
      background: #555;
      cursor: not-allowed;
    }
    
    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
      margin: 8px 0 15px 0;
    }
    
    input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    input:read-only {
      background: #0d1117;
      color: #7ee787;
      font-family: monospace;
    }
    
    label {
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .input-group {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }
    
    .input-group input {
      flex: 1;
    }
    
    .input-group button {
      margin-top: 8px;
      padding: 12px 20px;
      white-space: nowrap;
    }
    
    .info-box {
      background: rgba(233, 69, 96, 0.1);
      border-left: 4px solid var(--accent);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
    }
    
    .success-box {
      background: rgba(74, 222, 128, 0.1);
      border-left: 4px solid var(--success);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
    }
    
    .warning-box {
      background: rgba(251, 191, 36, 0.1);
      border-left: 4px solid var(--warning);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
    }
    
    .progress-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 30px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--border);
      transition: background 0.3s;
    }
    
    .progress-dot.active { background: var(--accent); }
    .progress-dot.completed { background: var(--success); }
    
    .choice-buttons {
      display: flex;
      gap: 20px;
      margin: 30px 0;
    }
    
    .choice-btn {
      flex: 1;
      padding: 30px 20px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .choice-btn:hover { border-color: var(--accent); }
    
    .choice-btn.selected {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }
    
    .choice-btn .icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .choice-btn h3 {
      margin: 0 0 10px 0;
      font-size: 1.3rem;
    }
    
    .choice-btn p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .help-text {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 5px;
    }
    
    .hidden { display: none !important; }
    
    .inline-code {
      background: #0d1117;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
      color: #7ee787;
    }

    .mode-option {
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-option:hover { border-color: var(--accent); }

    .mode-option.selected {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }

    .mode-option h3 {
      margin: 0 0 8px 0;
      color: var(--text);
    }

    .mode-option p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .download-section {
      background: var(--bg);
      border: 2px solid var(--success);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      margin: 20px 0;
    }

    .download-section h3 {
      margin: 0 0 10px 0;
      color: var(--success);
      font-size: 1.3rem;
    }

    .download-section p {
      margin: 0 0 20px 0;
      color: var(--text-secondary);
    }

    .big-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      background: var(--accent);
      color: white;
      border-radius: 50%;
      font-size: 1.5rem;
      font-weight: bold;
      margin-right: 15px;
    }

    .instruction-step {
      display: flex;
      align-items: flex-start;
      background: var(--bg);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
    }

    .instruction-step .content {
      flex: 1;
    }

    .instruction-step h4 {
      margin: 0 0 8px 0;
      font-size: 1.1rem;
    }

    .instruction-step p {
      margin: 0;
      color: var(--text-secondary);
    }

    .final-step h2 {
      color: var(--success);
      text-align: center;
    }

    .checklist {
      list-style: none;
      padding: 0;
      margin: 20px 0;
    }

    .checklist li {
      padding: 12px 15px;
      background: var(--bg);
      border-radius: 8px;
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .checklist li::before {
      content: "‚úì";
      color: var(--success);
      font-weight: bold;
      font-size: 1.2rem;
    }

    .os-specific { display: none; }
    .os-specific.active { display: block; }

    @media (max-width: 600px) {
      .choice-buttons, .buttons { flex-direction: column; }
      button { width: 100%; }
      .input-group { flex-direction: column; }
      .input-group button { width: 100%; margin-top: 0; }
      .choice-btn { padding: 20px 15px; }
      .choice-btn .icon { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Mudscape Installer</h1>
      <p class="subtitle">Accessible MUD Client - Setup Wizard</p>
    </header>

    <div class="progress-bar" id="progressBar"></div>

    <!-- Step 0: Install Type -->
    <div class="step active" id="step-0">
      <div class="step-header">
        <div class="step-number">1</div>
        <div class="step-title">What would you like to do?</div>
      </div>
      <div class="step-content">
        <div class="choice-buttons">
          <button class="choice-btn" onclick="selectInstallType('fresh')">
            <div class="icon">üÜï</div>
            <h3>Fresh Install</h3>
            <p>Install Mudscape for the first time on this computer</p>
          </button>
          <button class="choice-btn" onclick="selectInstallType('upgrade')">
            <div class="icon">‚¨ÜÔ∏è</div>
            <h3>Upgrade</h3>
            <p>Update an existing Mudscape installation to the latest version</p>
          </button>
          <button class="choice-btn" onclick="selectInstallType('uninstall')">
            <div class="icon">üóëÔ∏è</div>
            <h3>Uninstall</h3>
            <p>Remove Mudscape from this computer</p>
          </button>
        </div>
      </div>
    </div>

    <!-- Step 1: OS Selection -->
    <div class="step" id="step-1">
      <div class="step-header">
        <div class="step-number">2</div>
        <div class="step-title">What computer are you using?</div>
      </div>
      <div class="step-content">
        <div class="choice-buttons">
          <button class="choice-btn" onclick="selectOS('mac')">
            <div class="icon">üçé</div>
            <h3>Mac</h3>
            <p>macOS</p>
          </button>
          <button class="choice-btn" onclick="selectOS('windows')">
            <div class="icon">ü™ü</div>
            <h3>Windows</h3>
            <p>Windows 10/11</p>
          </button>
          <button class="choice-btn" onclick="selectOS('linux')">
            <div class="icon">üêß</div>
            <h3>Linux</h3>
            <p>Ubuntu, Fedora, etc.</p>
          </button>
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <div></div>
      </div>
    </div>

    <!-- Step 2: Prerequisites (Fresh Install Only) -->
    <div class="step" id="step-2">
      <div class="step-header">
        <div class="step-number">3</div>
        <div class="step-title">Required Software</div>
      </div>
      <div class="step-content">
        <p>Mudscape needs these programs installed first. If you don't have them, click the links to download:</p>

        <div class="instruction-step">
          <span class="big-number">1</span>
          <div class="content">
            <h4>Node.js</h4>
            <p>Go to <a href="https://nodejs.org" target="_blank" style="color: var(--accent);">nodejs.org</a> and click the big green "LTS" button. Run the downloaded installer.</p>
          </div>
        </div>

        <div class="instruction-step">
          <span class="big-number">2</span>
          <div class="content">
            <h4>PostgreSQL Database</h4>
            <div class="os-specific mac active" data-os="mac">
              <p>Go to <a href="https://postgresapp.com" target="_blank" style="color: var(--accent);">postgresapp.com</a> and download the app. Open it and click "Initialize".</p>
            </div>
            <div class="os-specific windows" data-os="windows">
              <p>Go to <a href="https://www.postgresql.org/download/windows/" target="_blank" style="color: var(--accent);">postgresql.org/download/windows</a> and download the installer. Remember the password you set!</p>
            </div>
            <div class="os-specific linux" data-os="linux">
              <p>Open Terminal and run: <span class="inline-code">sudo apt install postgresql</span> (Ubuntu) or <span class="inline-code">sudo dnf install postgresql-server</span> (Fedora)</p>
            </div>
          </div>
        </div>

        <div class="instruction-step">
          <span class="big-number">3</span>
          <div class="content">
            <h4>Git</h4>
            <div class="os-specific mac active" data-os="mac">
              <p>Usually pre-installed on Mac. If not, it will prompt you to install when you run the setup.</p>
            </div>
            <div class="os-specific windows" data-os="windows">
              <p>Go to <a href="https://git-scm.com/download/win" target="_blank" style="color: var(--accent);">git-scm.com</a> and download the installer.</p>
            </div>
            <div class="os-specific linux" data-os="linux">
              <p>Usually pre-installed. If not: <span class="inline-code">sudo apt install git</span></p>
            </div>
          </div>
        </div>

        <div class="success-box">
          <strong>Already have these installed?</strong> Great! Click "Next Step" to continue.
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn-primary" onclick="nextStep()">Next Step</button>
      </div>
    </div>

    <!-- Step 3: Account Mode (Fresh Install Only) -->
    <div class="step" id="step-3">
      <div class="step-header">
        <div class="step-number">4</div>
        <div class="step-title">Account Mode</div>
      </div>
      <div class="step-content">
        <p>How will Mudscape be used?</p>
        
        <div class="mode-option" onclick="selectMode('single')" id="mode-single">
          <h3>üßë Just Me (Single-User Mode)</h3>
          <p>No login required. Perfect for personal use on your own computer.</p>
        </div>

        <div class="mode-option" onclick="selectMode('multi')" id="mode-multi">
          <h3>üë• Multiple People (Multi-User Mode)</h3>
          <p>Requires login. Use this if others will access Mudscape too.</p>
        </div>

        <div id="adminSetup" class="hidden" style="margin-top: 20px;">
          <div class="info-box">
            <strong>Create your admin account:</strong>
          </div>
          
          <label for="adminUser">Username</label>
          <input type="text" id="adminUser" placeholder="Choose a username" value="admin">
          
          <label for="adminPass">Password</label>
          <div class="input-group">
            <input type="text" id="adminPass" placeholder="Choose a password">
            <button class="btn-secondary" onclick="generatePassword()">Generate Random</button>
          </div>
          <p class="help-text">‚ö†Ô∏è Write this password down somewhere safe!</p>
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn-primary" onclick="nextStep()" id="modeNext" disabled>Next Step</button>
      </div>
    </div>

    <!-- Step 4: Database Settings -->
    <div class="step" id="step-4">
      <div class="step-header">
        <div class="step-number" id="dbStepNum">5</div>
        <div class="step-title">Database Settings</div>
      </div>
      <div class="step-content">
        <p>Enter your PostgreSQL database details. The defaults usually work for most setups.</p>

        <label for="dbUser">Database Username</label>
        <input type="text" id="dbUser" placeholder="Your database username">
        <p class="help-text" id="dbUserHelp"></p>

        <label for="dbPassword">Database Password</label>
        <input type="text" id="dbPassword" placeholder="Leave blank if you didn't set one">

        <div class="info-box" id="advancedToggle" style="cursor: pointer;" onclick="toggleAdvanced()">
          <strong>‚ñ∂ Advanced Settings</strong> (click to expand)
        </div>

        <div id="advancedSettings" class="hidden">
          <label for="dbHost">Database Host</label>
          <input type="text" id="dbHost" value="localhost">

          <label for="dbPort">Database Port</label>
          <input type="number" id="dbPort" value="5432">

          <label for="dbName">Database Name</label>
          <input type="text" id="dbName" value="mudscape">

          <label for="appPort">Mudscape Port</label>
          <input type="number" id="appPort" value="5000">
        </div>

        <label for="sessionSecret">Security Key</label>
        <div class="input-group">
          <input type="text" id="sessionSecret" readonly placeholder="Click Generate">
          <button class="btn-success" onclick="generateSessionSecret()">Generate</button>
        </div>
        <p class="help-text">This keeps your sessions secure. Just click Generate.</p>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn-primary" onclick="validateAndContinue()">Next Step</button>
      </div>
    </div>

    <!-- Step 5: Download & Run -->
    <div class="step" id="step-5">
      <div class="step-header">
        <div class="step-number" id="downloadStepNum">6</div>
        <div class="step-title" id="downloadStepTitle">Download & Run</div>
      </div>
      <div class="step-content">
        <div class="download-section">
          <h3>Download Your Setup File</h3>
          <p>Click the button below to download. Then double-click the file to run it!</p>
          <button class="btn-success btn-large" onclick="downloadAllInOne()" id="downloadBtn">
            Download Mudscape Installer
          </button>
        </div>

        <div class="instruction-step">
          <span class="big-number">1</span>
          <div class="content">
            <h4>Find the downloaded file</h4>
            <p>Look in your Downloads folder for <span class="inline-code" id="scriptFilename">mudscape-install.command</span></p>
          </div>
        </div>

        <div class="instruction-step" id="macStep2">
          <span class="big-number">2</span>
          <div class="content">
            <h4>Allow it to run (Mac only - first time)</h4>
            <p>Right-click the file ‚Üí Click "Open" ‚Üí Click "Open" again in the popup. You only need to do this once.</p>
          </div>
        </div>

        <div class="instruction-step">
          <span class="big-number" id="runStepNum">3</span>
          <div class="content">
            <h4>Double-click to run</h4>
            <p>A window will open showing the installation progress. Wait for it to finish.</p>
          </div>
        </div>

        <div class="success-box">
          <strong>The installer will:</strong>
          <ul style="margin: 10px 0 0 0; padding-left: 20px;">
            <li id="action1">Download Mudscape</li>
            <li id="action2">Set up everything automatically</li>
            <li>Open Mudscape in your browser when ready</li>
          </ul>
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn-primary" onclick="nextStep()">I've Run the Installer</button>
      </div>
    </div>

    <!-- Step 6: Complete -->
    <div class="step" id="step-6">
      <div class="step-header">
        <div class="step-number" id="completeStepNum">7</div>
        <div class="step-title">All Done!</div>
      </div>
      <div class="step-content final-step">
        <h2>üéâ Congratulations!</h2>
        
        <p style="text-align: center; font-size: 1.1rem;">Mudscape should now be running in your browser at:</p>
        
        <div class="code-block" style="text-align: center; font-size: 1.3rem;">
          <code id="finalUrl">http://localhost:5000</code>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>

        <ul class="checklist" id="completeChecklist">
          <li>Mudscape is installed</li>
          <li>Database is set up</li>
          <li id="modeConfirm">Running in single-user mode</li>
        </ul>

        <div class="warning-box">
          <strong>üóëÔ∏è Security Reminder:</strong> Please delete this installer file now. It contains your configuration details.
        </div>

        <div class="info-box">
          <strong>To start Mudscape later:</strong>
          <p style="margin: 10px 0 0 0;">Double-click <span class="inline-code" id="startScriptName">mudscape-start.command</span> in your Documents ‚Üí mudscape folder.</p>
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn-primary" onclick="window.print()">Print These Instructions</button>
      </div>
    </div>

    <!-- Step 7: Uninstall -->
    <div class="step" id="step-7">
      <div class="step-header">
        <div class="step-number">2</div>
        <div class="step-title">Uninstall Mudscape</div>
      </div>
      <div class="step-content">
        <div class="warning-box" style="border-color: var(--accent);">
          <strong>‚ö†Ô∏è This will permanently remove Mudscape from your computer.</strong>
          <p style="margin: 10px 0 0 0;">Your profiles, triggers, aliases, and all settings will be deleted.</p>
        </div>

        <p><strong>What would you like to remove?</strong></p>

        <div class="mode-option selected" onclick="toggleUninstallOption('app')" id="uninstall-app">
          <h3>üìÅ Mudscape Application</h3>
          <p>Remove the Mudscape folder and all application files</p>
        </div>

        <div class="mode-option" onclick="toggleUninstallOption('db')" id="uninstall-db">
          <h3>üóÑÔ∏è Database (Optional)</h3>
          <p>Also remove the Mudscape database. Leave unchecked to keep your data for reinstallation.</p>
        </div>

        <div class="download-section" style="border-color: var(--accent); margin-top: 30px;">
          <h3 style="color: var(--accent);">Download Uninstaller</h3>
          <p>Double-click the downloaded file to remove Mudscape.</p>
          <button class="btn-primary btn-large" onclick="downloadUninstaller()" id="uninstallBtn">
            Download Uninstaller
          </button>
        </div>

        <div class="instruction-step">
          <span class="big-number">1</span>
          <div class="content">
            <h4>Find the downloaded file</h4>
            <p>Look in your Downloads folder for <span class="inline-code" id="uninstallFilename">Mudscape-Uninstall.command</span></p>
          </div>
        </div>

        <div class="instruction-step" id="uninstallMacStep">
          <span class="big-number">2</span>
          <div class="content">
            <h4>Allow it to run (Mac only)</h4>
            <p>Right-click the file ‚Üí Click "Open" ‚Üí Click "Open" again in the popup.</p>
          </div>
        </div>

        <div class="instruction-step">
          <span class="big-number" id="uninstallRunStep">3</span>
          <div class="content">
            <h4>Double-click to run</h4>
            <p>Follow the prompts. You'll be asked to confirm before anything is deleted.</p>
          </div>
        </div>
      </div>
      <div class="buttons">
        <button class="btn-secondary" onclick="showStep(0)">Back to Start</button>
        <div></div>
      </div>
    </div>

    <!-- Step 8: Uninstall Complete -->
    <div class="step" id="step-8">
      <div class="step-header">
        <div class="step-number">‚úì</div>
        <div class="step-title">Uninstall Complete</div>
      </div>
      <div class="step-content final-step">
        <h2 style="color: var(--text);">Mudscape has been removed</h2>
        
        <ul class="checklist">
          <li>Application files deleted</li>
          <li id="dbRemoveConfirm">Database preserved (can reinstall later)</li>
        </ul>

        <div class="info-box">
          <strong>Want to reinstall?</strong>
          <p style="margin: 10px 0 0 0;">Just run this installer again and choose "Fresh Install".</p>
        </div>

        <div class="warning-box">
          <strong>üóëÔ∏è Reminder:</strong> Please delete this installer file now.
        </div>
      </div>
      <div class="buttons">
        <button class="btn-primary" onclick="showStep(0)">Start Over</button>
        <div></div>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 0;
    let totalSteps = 7;
    let selectedOS = null;
    let accountMode = null;
    let installType = null; // 'fresh', 'upgrade', or 'uninstall'
    let removeDatabase = false;
    
    // Step mapping for fresh install vs upgrade vs uninstall
    const freshSteps = [0, 1, 2, 3, 4, 5, 6];
    const upgradeSteps = [0, 1, 5, 6]; // Skip prerequisites, account mode, and some config
    const uninstallSteps = [0, 1, 7]; // Just OS selection then uninstall
    let activeSteps = freshSteps;

    document.addEventListener('DOMContentLoaded', () => {
      updateProgressBar();
    });

    function updateProgressBar() {
      const bar = document.getElementById('progressBar');
      bar.innerHTML = '';
      const stepIndex = activeSteps.indexOf(currentStep);
      for (let i = 0; i < activeSteps.length; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        if (i < stepIndex) dot.classList.add('completed');
        if (i === stepIndex) dot.classList.add('active');
        bar.appendChild(dot);
      }
    }

    function showStep(stepNum) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById(`step-${stepNum}`).classList.add('active');
      currentStep = stepNum;
      updateProgressBar();
      window.scrollTo(0, 0);
    }

    function nextStep() {
      const stepIndex = activeSteps.indexOf(currentStep);
      if (stepIndex < activeSteps.length - 1) {
        showStep(activeSteps[stepIndex + 1]);
      }
    }

    function prevStep() {
      const stepIndex = activeSteps.indexOf(currentStep);
      if (stepIndex > 0) {
        showStep(activeSteps[stepIndex - 1]);
      }
    }

    function selectInstallType(type) {
      installType = type;
      document.querySelectorAll('#step-0 .choice-btn').forEach(btn => btn.classList.remove('selected'));
      event.target.closest('.choice-btn').classList.add('selected');
      
      if (type === 'fresh') {
        activeSteps = freshSteps;
        totalSteps = 7;
      } else if (type === 'upgrade') {
        activeSteps = upgradeSteps;
        totalSteps = 4;
        // Update step numbers for upgrade flow
        document.getElementById('downloadStepNum').textContent = '3';
        document.getElementById('completeStepNum').textContent = '4';
        document.getElementById('downloadStepTitle').textContent = 'Download & Run Upgrade';
        document.getElementById('action1').textContent = 'Update Mudscape to the latest version';
        document.getElementById('action2').textContent = 'Preserve your settings and data';
      } else if (type === 'uninstall') {
        activeSteps = uninstallSteps;
        totalSteps = 3;
      }
      
      updateProgressBar();
      setTimeout(() => nextStep(), 300);
    }

    function toggleUninstallOption(option) {
      if (option === 'db') {
        removeDatabase = !removeDatabase;
        document.getElementById('uninstall-db').classList.toggle('selected', removeDatabase);
        document.getElementById('dbRemoveConfirm').textContent = removeDatabase 
          ? 'Database removed' 
          : 'Database preserved (can reinstall later)';
      }
    }

    function selectOS(os) {
      selectedOS = os;
      document.querySelectorAll('#step-1 .choice-btn').forEach(btn => btn.classList.remove('selected'));
      event.target.closest('.choice-btn').classList.add('selected');
      
      // Update OS-specific content
      document.querySelectorAll('.os-specific').forEach(el => {
        el.classList.remove('active');
        if (el.dataset.os === os) el.classList.add('active');
      });
      
      updateOSContent();
      setTimeout(() => nextStep(), 300);
    }

    function updateOSContent() {
      const scriptFilename = document.getElementById('scriptFilename');
      const macStep2 = document.getElementById('macStep2');
      const runStepNum = document.getElementById('runStepNum');
      const dbUserHelp = document.getElementById('dbUserHelp');
      const startScriptName = document.getElementById('startScriptName');
      const downloadBtn = document.getElementById('downloadBtn');
      const uninstallFilename = document.getElementById('uninstallFilename');
      const uninstallMacStep = document.getElementById('uninstallMacStep');
      const uninstallRunStep = document.getElementById('uninstallRunStep');
      const uninstallBtn = document.getElementById('uninstallBtn');

      if (selectedOS === 'mac') {
        scriptFilename.textContent = 'Mudscape-Install.command';
        macStep2.style.display = 'flex';
        runStepNum.textContent = '3';
        dbUserHelp.textContent = 'Usually your Mac username (the name of your home folder)';
        startScriptName.textContent = 'Mudscape-Start.command';
        downloadBtn.textContent = 'Download Mudscape Installer (.command)';
        uninstallFilename.textContent = 'Mudscape-Uninstall.command';
        uninstallMacStep.style.display = 'flex';
        uninstallRunStep.textContent = '3';
        uninstallBtn.textContent = 'Download Uninstaller (.command)';
      } else if (selectedOS === 'windows') {
        scriptFilename.textContent = 'Mudscape-Install.bat';
        macStep2.style.display = 'none';
        runStepNum.textContent = '2';
        dbUserHelp.textContent = 'Usually "postgres" (the default PostgreSQL user)';
        startScriptName.textContent = 'Mudscape-Start.bat';
        downloadBtn.textContent = 'Download Mudscape Installer (.bat)';
        uninstallFilename.textContent = 'Mudscape-Uninstall.bat';
        uninstallMacStep.style.display = 'none';
        uninstallRunStep.textContent = '2';
        uninstallBtn.textContent = 'Download Uninstaller (.bat)';
      } else if (selectedOS === 'linux') {
        scriptFilename.textContent = 'Mudscape-Install.sh';
        macStep2.style.display = 'none';
        runStepNum.textContent = '2';
        dbUserHelp.textContent = 'Usually your Linux username';
        startScriptName.textContent = 'Mudscape-Start.sh';
        downloadBtn.textContent = 'Download Mudscape Installer (.sh)';
        uninstallFilename.textContent = 'Mudscape-Uninstall.sh';
        uninstallMacStep.style.display = 'none';
        uninstallRunStep.textContent = '2';
        uninstallBtn.textContent = 'Download Uninstaller (.sh)';
      }
    }

    function selectMode(mode) {
      accountMode = mode;
      document.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('selected'));
      document.getElementById(`mode-${mode}`).classList.add('selected');
      document.getElementById('adminSetup').classList.toggle('hidden', mode !== 'multi');
      document.getElementById('modeNext').disabled = false;
      
      document.getElementById('modeConfirm').textContent = 
        mode === 'single' ? 'Running in single-user mode (no login required)' : 'Running in multi-user mode';
    }

    function toggleAdvanced() {
      const settings = document.getElementById('advancedSettings');
      const toggle = document.getElementById('advancedToggle');
      settings.classList.toggle('hidden');
      toggle.innerHTML = settings.classList.contains('hidden') 
        ? '<strong>‚ñ∂ Advanced Settings</strong> (click to expand)'
        : '<strong>‚ñº Advanced Settings</strong> (click to collapse)';
    }

    function generateRandomString(length) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      const array = new Uint32Array(length);
      crypto.getRandomValues(array);
      for (let i = 0; i < length; i++) {
        result += chars[array[i] % chars.length];
      }
      return result;
    }

    function generatePassword() {
      document.getElementById('adminPass').value = generateRandomString(16);
    }

    function generateSessionSecret() {
      document.getElementById('sessionSecret').value = generateRandomString(64);
    }

    function validateAndContinue() {
      const secret = document.getElementById('sessionSecret').value;
      if (!secret) {
        generateSessionSecret();
      }
      nextStep();
    }

    function getConfig() {
      const host = document.getElementById('dbHost')?.value || 'localhost';
      const port = document.getElementById('dbPort')?.value || '5432';
      const user = document.getElementById('dbUser')?.value || (selectedOS === 'windows' ? 'postgres' : '$USER');
      const password = document.getElementById('dbPassword')?.value || '';
      const dbName = document.getElementById('dbName')?.value || 'mudscape';
      const appPort = document.getElementById('appPort')?.value || '5000';
      const sessionSecret = document.getElementById('sessionSecret')?.value || generateRandomString(64);
      const adminUser = document.getElementById('adminUser')?.value || 'admin';
      const adminPass = document.getElementById('adminPass')?.value || '';

      return { host, port, user, password, dbName, appPort, sessionSecret, adminUser, adminPass };
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function generateMacScript() {
      const config = getConfig();
      const isUpgrade = installType === 'upgrade';
      const repoUrl = 'https://github.com/YOUR_USERNAME/mudscape.git';
      
      const pwPart = config.password ? `:${config.password}` : '';
      const dbUrl = `postgresql://${config.user}${pwPart}@${config.host}:${config.port}/${config.dbName}`;

      let script = `#!/bin/bash
# Mudscape ${isUpgrade ? 'Upgrade' : 'Install'} Script for Mac
# Double-click this file to run it

# Keep the terminal window open on error
trap 'echo ""; echo "Press any key to close..."; read -n 1' EXIT

clear
echo "========================================"
echo "   Mudscape ${isUpgrade ? 'Upgrade' : 'Installer'}"
echo "========================================"
echo ""

`;

      if (!isUpgrade) {
        script += `# Check for required software
echo "Checking requirements..."

if ! command -v node &> /dev/null; then
    echo ""
    echo "‚ùå Node.js is not installed."
    echo ""
    echo "Please download it from: https://nodejs.org"
    echo "Click the green LTS button, then run the installer."
    echo ""
    exit 1
fi
echo "‚úÖ Node.js found: $(node --version)"

if ! command -v git &> /dev/null; then
    echo ""
    echo "‚ùå Git is not installed."
    echo "Please install Xcode Command Line Tools."
    xcode-select --install
    exit 1
fi
echo "‚úÖ Git found"

`;
      }

      script += `# Set up directories
INSTALL_DIR="$HOME/Documents/mudscape"
mkdir -p "$HOME/Documents"

`;

      if (isUpgrade) {
        script += `# Check if Mudscape exists
if [ ! -d "$INSTALL_DIR" ]; then
    echo ""
    echo "‚ùå Mudscape installation not found at $INSTALL_DIR"
    echo "Please run a fresh install instead."
    exit 1
fi

echo "Updating Mudscape..."
cd "$INSTALL_DIR"
git stash 2>/dev/null || true
git pull origin main || git pull origin master || {
    echo "‚ùå Could not update. Please check your internet connection."
    exit 1
}
git stash pop 2>/dev/null || true

`;
      } else {
        script += `# Download Mudscape
if [ -d "$INSTALL_DIR" ]; then
    echo "Mudscape folder exists. Updating..."
    cd "$INSTALL_DIR"
    git pull origin main 2>/dev/null || git pull origin master 2>/dev/null || true
else
    echo "Downloading Mudscape..."
    cd "$HOME/Documents"
    git clone ${repoUrl} mudscape || {
        echo ""
        echo "‚ùå Download failed. Please check your internet connection."
        exit 1
    }
fi
cd "$INSTALL_DIR"
echo "‚úÖ Mudscape downloaded"

# Create configuration file
echo ""
echo "Setting up configuration..."
cat > "$INSTALL_DIR/.env" << 'ENVFILE'
DATABASE_URL=${dbUrl}
SESSION_SECRET=${config.sessionSecret}
PORT=${config.appPort}
${accountMode === 'single' ? 'SINGLE_USER_MODE=true' : ''}
ENVFILE
echo "‚úÖ Configuration saved"

`;
      }

      script += `# Install dependencies
echo ""
echo "Installing dependencies (this may take a few minutes)..."
cd "$INSTALL_DIR"
npm install || {
    echo "‚ùå Failed to install dependencies."
    exit 1
}
echo "‚úÖ Dependencies installed"

`;

      if (!isUpgrade) {
        script += `# Set up database
echo ""
echo "Setting up database..."
createdb ${config.dbName} 2>/dev/null || echo "(Database may already exist)"
npm run db:push || {
    echo ""
    echo "‚ö†Ô∏è Database setup had issues. You may need to check PostgreSQL is running."
}
echo "‚úÖ Database ready"

`;
      }

      script += `# Create start script
cat > "$INSTALL_DIR/Mudscape-Start.command" << 'STARTSCRIPT'
#!/bin/bash
cd "$HOME/Documents/mudscape"
echo "Starting Mudscape..."
echo "Opening browser to http://localhost:${config.appPort}"
sleep 2 && open "http://localhost:${config.appPort}" &
npm run dev
STARTSCRIPT
chmod +x "$INSTALL_DIR/Mudscape-Start.command"

echo ""
echo "========================================"
echo "   ‚úÖ ${isUpgrade ? 'Upgrade' : 'Installation'} Complete!"
echo "========================================"
echo ""
echo "Opening Mudscape in your browser..."
echo ""

# Open browser and start server
sleep 2 && open "http://localhost:${config.appPort}" &
npm run dev
`;

      return script;
    }

    function generateWindowsScript() {
      const config = getConfig();
      const isUpgrade = installType === 'upgrade';
      const repoUrl = 'https://github.com/YOUR_USERNAME/mudscape.git';
      
      const pwPart = config.password ? `:${config.password}` : '';
      const dbUrl = `postgresql://${config.user}${pwPart}@${config.host}:${config.port}/${config.dbName}`;

      let script = `@echo off
REM Mudscape ${isUpgrade ? 'Upgrade' : 'Install'} Script for Windows
REM Double-click this file to run it

title Mudscape ${isUpgrade ? 'Upgrade' : 'Installer'}

echo ========================================
echo    Mudscape ${isUpgrade ? 'Upgrade' : 'Installer'}
echo ========================================
echo.

`;

      if (!isUpgrade) {
        script += `REM Check for Node.js
where node >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo [ERROR] Node.js is not installed.
    echo.
    echo Please download it from: https://nodejs.org
    echo Click the green LTS button, then run the installer.
    echo.
    pause
    exit /b 1
)
for /f "tokens=*" %%i in ('node --version') do echo [OK] Node.js found: %%i

where git >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo [ERROR] Git is not installed.
    echo Please download it from: https://git-scm.com
    echo.
    pause
    exit /b 1
)
echo [OK] Git found
echo.

`;
      }

      script += `set INSTALL_DIR=%USERPROFILE%\\Documents\\mudscape

`;

      if (isUpgrade) {
        script += `if not exist "%INSTALL_DIR%" (
    echo.
    echo [ERROR] Mudscape installation not found.
    echo Please run a fresh install instead.
    pause
    exit /b 1
)

echo Updating Mudscape...
cd /d "%INSTALL_DIR%"
git stash 2>nul
git pull origin main || git pull origin master
git stash pop 2>nul
echo [OK] Updated

`;
      } else {
        script += `if exist "%INSTALL_DIR%" (
    echo Updating existing installation...
    cd /d "%INSTALL_DIR%"
    git pull origin main 2>nul || git pull origin master 2>nul
) else (
    echo Downloading Mudscape...
    cd /d "%USERPROFILE%\\Documents"
    git clone ${repoUrl} mudscape
    if %ERRORLEVEL% NEQ 0 (
        echo [ERROR] Download failed.
        pause
        exit /b 1
    )
)
cd /d "%INSTALL_DIR%"
echo [OK] Mudscape downloaded

echo.
echo Setting up configuration...
(
echo DATABASE_URL=${dbUrl}
echo SESSION_SECRET=${config.sessionSecret}
echo PORT=${config.appPort}
${accountMode === 'single' ? 'echo SINGLE_USER_MODE=true' : ''}
) > "%INSTALL_DIR%\\.env"
echo [OK] Configuration saved

`;
      }

      script += `echo.
echo Installing dependencies (this may take a few minutes)...
cd /d "%INSTALL_DIR%"
call npm install
if %ERRORLEVEL% NEQ 0 (
    echo [ERROR] Failed to install dependencies.
    pause
    exit /b 1
)
echo [OK] Dependencies installed

`;

      if (!isUpgrade) {
        script += `echo.
echo Setting up database...
createdb ${config.dbName} 2>nul
call npm run db:push
echo [OK] Database ready

`;
      }

      script += `REM Create start script
(
echo @echo off
echo cd /d "%USERPROFILE%\\Documents\\mudscape"
echo echo Starting Mudscape...
echo start http://localhost:${config.appPort}
echo call npm run dev
) > "%INSTALL_DIR%\\Mudscape-Start.bat"

echo.
echo ========================================
echo    [OK] ${isUpgrade ? 'Upgrade' : 'Installation'} Complete!
echo ========================================
echo.
echo Opening Mudscape in your browser...
echo.

start http://localhost:${config.appPort}
call npm run dev
`;

      return script;
    }

    function generateLinuxScript() {
      const config = getConfig();
      const isUpgrade = installType === 'upgrade';
      const repoUrl = 'https://github.com/YOUR_USERNAME/mudscape.git';
      
      const pwPart = config.password ? `:${config.password}` : '';
      const dbUrl = `postgresql://${config.user}${pwPart}@${config.host}:${config.port}/${config.dbName}`;

      let script = `#!/bin/bash
# Mudscape ${isUpgrade ? 'Upgrade' : 'Install'} Script for Linux
# Run with: chmod +x Mudscape-Install.sh && ./Mudscape-Install.sh

set -e

echo "========================================"
echo "   Mudscape ${isUpgrade ? 'Upgrade' : 'Installer'}"
echo "========================================"
echo ""

`;

      if (!isUpgrade) {
        script += `# Check requirements
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js is not installed."
    echo "Install with: curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - && sudo apt-get install -y nodejs"
    exit 1
fi
echo "‚úÖ Node.js: $(node --version)"

if ! command -v git &> /dev/null; then
    echo "‚ùå Git is not installed. Install with: sudo apt install git"
    exit 1
fi
echo "‚úÖ Git found"

`;
      }

      script += `INSTALL_DIR="$HOME/Documents/mudscape"
mkdir -p "$HOME/Documents"

`;

      if (isUpgrade) {
        script += `if [ ! -d "$INSTALL_DIR" ]; then
    echo "‚ùå Mudscape not found. Please run fresh install."
    exit 1
fi

echo "Updating..."
cd "$INSTALL_DIR"
git stash 2>/dev/null || true
git pull origin main || git pull origin master
git stash pop 2>/dev/null || true

`;
      } else {
        script += `if [ -d "$INSTALL_DIR" ]; then
    cd "$INSTALL_DIR"
    git pull origin main 2>/dev/null || git pull origin master 2>/dev/null || true
else
    cd "$HOME/Documents"
    git clone ${repoUrl} mudscape
fi
cd "$INSTALL_DIR"
echo "‚úÖ Downloaded"

cat > "$INSTALL_DIR/.env" << 'ENVFILE'
DATABASE_URL=${dbUrl}
SESSION_SECRET=${config.sessionSecret}
PORT=${config.appPort}
${accountMode === 'single' ? 'SINGLE_USER_MODE=true' : ''}
ENVFILE
echo "‚úÖ Configured"

`;
      }

      script += `echo "Installing dependencies..."
npm install
echo "‚úÖ Dependencies installed"

`;

      if (!isUpgrade) {
        script += `echo "Setting up database..."
createdb ${config.dbName} 2>/dev/null || true
npm run db:push
echo "‚úÖ Database ready"

`;
      }

      script += `cat > "$INSTALL_DIR/Mudscape-Start.sh" << 'STARTSCRIPT'
#!/bin/bash
cd "$HOME/Documents/mudscape"
echo "Starting Mudscape at http://localhost:${config.appPort}"
xdg-open "http://localhost:${config.appPort}" 2>/dev/null &
npm run dev
STARTSCRIPT
chmod +x "$INSTALL_DIR/Mudscape-Start.sh"

echo ""
echo "‚úÖ ${isUpgrade ? 'Upgrade' : 'Installation'} Complete!"
echo ""
echo "Opening browser..."

xdg-open "http://localhost:${config.appPort}" 2>/dev/null &
npm run dev
`;

      return script;
    }

    function downloadAllInOne() {
      const config = getConfig();
      document.getElementById('finalUrl').textContent = `http://localhost:${config.appPort}`;
      
      if (selectedOS === 'mac') {
        downloadFile('Mudscape-Install.command', generateMacScript());
      } else if (selectedOS === 'windows') {
        downloadFile('Mudscape-Install.bat', generateWindowsScript());
      } else {
        downloadFile('Mudscape-Install.sh', generateLinuxScript());
      }
    }

    function generateMacUninstaller() {
      const dbName = 'mudscape';
      
      return `#!/bin/bash
# Mudscape Uninstaller for Mac
# Double-click this file to run it

trap 'echo ""; echo "Press any key to close..."; read -n 1' EXIT

clear
echo "========================================"
echo "   Mudscape Uninstaller"
echo "========================================"
echo ""

INSTALL_DIR="$HOME/Documents/mudscape"

if [ ! -d "$INSTALL_DIR" ]; then
    echo "Mudscape is not installed at $INSTALL_DIR"
    echo ""
    exit 0
fi

echo "This will remove Mudscape from your computer."
${removeDatabase ? 'echo "The database will also be deleted."' : 'echo "Your database will be preserved for reinstallation."'}
echo ""
read -p "Are you sure you want to continue? (y/n): " confirm

if [ "$confirm" != "y" ] && [ "$confirm" != "Y" ]; then
    echo ""
    echo "Uninstall cancelled."
    exit 0
fi

echo ""
echo "Removing Mudscape..."

# Remove the application folder
rm -rf "$INSTALL_DIR"
echo "‚úÖ Application files removed"

${removeDatabase ? `
# Remove the database
echo "Removing database..."
dropdb ${dbName} 2>/dev/null && echo "‚úÖ Database removed" || echo "‚ö†Ô∏è Could not remove database (may not exist)"
` : '# Database preserved'}

echo ""
echo "========================================"
echo "   ‚úÖ Mudscape has been uninstalled"
echo "========================================"
echo ""
${removeDatabase ? '' : 'echo "Your database has been preserved. If you reinstall,"'}
${removeDatabase ? '' : 'echo "your profiles and settings will still be there."'}
${removeDatabase ? '' : 'echo ""'}
echo "You can delete this uninstaller file now."
echo ""
`;
    }

    function generateWindowsUninstaller() {
      const dbName = 'mudscape';
      
      return `@echo off
REM Mudscape Uninstaller for Windows
REM Double-click this file to run it

title Mudscape Uninstaller

echo ========================================
echo    Mudscape Uninstaller
echo ========================================
echo.

set INSTALL_DIR=%USERPROFILE%\\Documents\\mudscape

if not exist "%INSTALL_DIR%" (
    echo Mudscape is not installed at %INSTALL_DIR%
    echo.
    pause
    exit /b 0
)

echo This will remove Mudscape from your computer.
${removeDatabase ? 'echo The database will also be deleted.' : 'echo Your database will be preserved for reinstallation.'}
echo.
set /p confirm="Are you sure you want to continue? (y/n): "

if /i not "%confirm%"=="y" (
    echo.
    echo Uninstall cancelled.
    pause
    exit /b 0
)

echo.
echo Removing Mudscape...

REM Remove the application folder
rmdir /s /q "%INSTALL_DIR%"
echo [OK] Application files removed

${removeDatabase ? `
REM Remove the database
echo Removing database...
dropdb ${dbName} 2>nul && echo [OK] Database removed || echo [WARNING] Could not remove database
` : 'REM Database preserved'}

echo.
echo ========================================
echo    [OK] Mudscape has been uninstalled
echo ========================================
echo.
${removeDatabase ? '' : 'echo Your database has been preserved.'}
${removeDatabase ? '' : 'echo If you reinstall, your settings will still be there.'}
${removeDatabase ? '' : 'echo.'}
echo You can delete this uninstaller file now.
echo.
pause
`;
    }

    function generateLinuxUninstaller() {
      const dbName = 'mudscape';
      
      return `#!/bin/bash
# Mudscape Uninstaller for Linux
# Run with: chmod +x Mudscape-Uninstall.sh && ./Mudscape-Uninstall.sh

echo "========================================"
echo "   Mudscape Uninstaller"
echo "========================================"
echo ""

INSTALL_DIR="$HOME/Documents/mudscape"

if [ ! -d "$INSTALL_DIR" ]; then
    echo "Mudscape is not installed at $INSTALL_DIR"
    exit 0
fi

echo "This will remove Mudscape from your computer."
${removeDatabase ? 'echo "The database will also be deleted."' : 'echo "Your database will be preserved for reinstallation."'}
echo ""
read -p "Are you sure? (y/n): " confirm

if [ "$confirm" != "y" ] && [ "$confirm" != "Y" ]; then
    echo "Cancelled."
    exit 0
fi

echo ""
echo "Removing Mudscape..."
rm -rf "$INSTALL_DIR"
echo "‚úÖ Application files removed"

${removeDatabase ? `
echo "Removing database..."
dropdb ${dbName} 2>/dev/null && echo "‚úÖ Database removed" || echo "‚ö†Ô∏è Could not remove database"
` : ''}

echo ""
echo "‚úÖ Mudscape has been uninstalled"
${removeDatabase ? '' : 'echo "Database preserved for reinstallation."'}
echo ""
`;
    }

    function downloadUninstaller() {
      if (selectedOS === 'mac') {
        downloadFile('Mudscape-Uninstall.command', generateMacUninstaller());
      } else if (selectedOS === 'windows') {
        downloadFile('Mudscape-Uninstall.bat', generateWindowsUninstaller());
      } else {
        downloadFile('Mudscape-Uninstall.sh', generateLinuxUninstaller());
      }
    }

    function copyCode(button) {
      const codeBlock = button.parentElement;
      const code = codeBlock.querySelector('code').textContent;
      
      navigator.clipboard.writeText(code).then(() => {
        button.textContent = 'Copied!';
        button.classList.add('copied');
        setTimeout(() => {
          button.textContent = 'Copy';
          button.classList.remove('copied');
        }, 2000);
      });
    }
  </script>
</body>
</html>
